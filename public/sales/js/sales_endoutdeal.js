var endoutdeal=function(){};endoutdeal.prototype.GetInit=function(){$("[name=CustomerID]").val("0").trigger("chosen:updated")},endoutdeal.prototype.GetUrlParam=function(a){var b=document.location.search.substring(1).split("&"),c={};for(i=0;i<b.length;i++){var d=decodeURIComponent(b[i]);if(d.indexOf("=")==-1)c[d.trim()]=!0;else{var e=d.split("=");c[e[0].trim()]=e[1].trim()}}return c[a]},endoutdeal.prototype.GetRefs=function(){$.ajax({url:"sales/endoutdeal/getrefs",type:"post",headers:{"X-CSRF-Token":$("meta[name=_token]").attr("content")},data:$("[name=CustomerID],[name=SalesDate]").serialize(),dataType:"json"}).done(function(a){console.log(a),$("[name=RefNo]").find("option").not("[value=0]").remove(),a.length?$.each(a,function(b,c){a[b].exist?$("[name=RefNo]").append('<option data-CryptID="'+a[b].id+'" data-exist="'+a[b].exist+'" value="'+a[b].refno+'">'+a[b].refno+"</option>"):$("[name=RefNo]").append('<option data-CryptID="'+a[b].id+'" data-nowlon="'+a[b].nowlon+'" data-custody="'+a[b].custody+'" data-tcarrying="'+a[b].totalcaring+'"  data-discount="'+a[b].discount+'" data-total="'+a[b].total+'"    value="'+a[b].refno+'">'+a[b].refno+"</option>")}):$("[name=RefNo]").find("option").not("[value=0]").remove()}).error(function(){_endoutdeal.ShowNotfication("Error Respone From Server, Try To reload Page",!1)})},endoutdeal.prototype.ShowNotification=function(a,b,c){var d=$("#"+c);$("#"+c).is(":visible")&&d.slideUp(),b?(d.removeClass("alert-danger"),d.addClass("alert-success")):(d.removeClass("alert-success"),d.addClass("alert-danger")),d.find("p").html(a),d.slideDown()},endoutdeal.prototype.EndOutDeal=function(){$.ajax({url:"endoutdeal/save/"+$("[name=RefNo] option:selected").attr("data-cryptid"),type:"post",headers:{"X-CSRF-Token":$("meta[name=_token]").attr("content")},data:$("#tbl-endoutdeal").find("select ,input").serialize(),dataType:"json"}).done(function(a){console.log(a);var b="";$.each(a.message,function(a,c){b+="* "+c+"<br />"}),endoutdeal.prototype.ShowNotification(b,a.status,"errorbox")}).error(function(){endoutdeal.prototype.ShowNotfication("Error Response From Server, Try To reload Page",!1)})},endoutdeal.prototype.UpdateOutDeal=function(){$.ajax({url:"update/"+endoutdeal.prototype.GetUrlParam("key"),type:"PUT",headers:{"X-CSRF-Token":$("meta[name=_token]").attr("content")},data:$("#tbl-endoutdeal").find("select ,input").serialize(),dataType:"json"}).done(function(a){var b="";$.each(a.message,function(a,c){b+="* "+c+"<br />"}),endoutdeal.prototype.ShowNotification(b,a.status,"errorbox")}).error(function(){endoutdeal.prototype.ShowNotfication("Error Response From Server, Try To reload Page",!1)})},endoutdeal.prototype.GetCalc=function(){var a=parseInt(isNaN($("#valuesold").val())?$("#valuesold").val("0").val():$("#valuesold").val()),b=parseInt(isNaN($("#billexpenses").val())?$("#billexpenses").val("0").val():$("#billexpenses").val()),c=parseInt(isNaN($("#commision").val())?$("#commision").val("0").val():$("#commision").val()),d=parseInt(isNaN($("#toftotal").val())?$("#toftotal").val("0").val():$("#toftotal").val()),e=parseInt(isNaN($("#internalexpenses").val())?$("#internalexpenses").val("0").val():$("#internalexpenses").val()),f=$("#total1").text(isNaN(a-b-c)?"0":a-b-c);parseInt(f.text())>0?f.addClass("alert-success").removeClass("alert-danger"):f.addClass("alert-danger").removeClass("alert-success");var g=$("#total2").text(isNaN(d+e)?"0":d+e);parseInt(g.text())>0?g.addClass("alert-success").removeClass("alert-danger"):g.addClass("alert-danger").removeClass("alert-success"),$("#netprofit-loss").text(parseInt(f.text())-parseInt(g.text())).text()>0?$("#netprofit-loss").addClass("alert-success").removeClass("alert-danger"):$("#netprofit-loss").addClass("alert-danger").removeClass("alert-success")},$(document).ready(function(){_endoutdeal=new endoutdeal,_endoutdeal.GetInit(),_endoutdeal.GetCalc(),$("[name=CustomerID] ,[name=SalesDate] ").change(function(){"0"!=$(this).find("option:selected").val()?_endoutdeal.GetRefs():$("[name=RefNo]").find("option").not("[value=0]").remove()}),$("[name=RefNo]").change(function(){var a=$(this).find("option:selected");if("true"==a.attr("data-exist"))window.location.href="endoutdeal/edit?key="+a.attr("data-cryptid");else{var b=parseInt(a.attr("data-nowlon"))+parseInt(a.attr("data-tcarrying"))+parseInt(a.attr("data-custody"))-parseInt(a.attr("data-discount")),c=parseInt(a.attr("data-total"));isNaN(b)&&(b=0),isNaN(c)&&(c=0),$("#internalexpenses").val(b),$("#toftotal").val(c),_endoutdeal.GetCalc()}}),$("#valuesold ,#billexpenses ,#commision ,#toftotal ,#internalexpenses").change(function(){_endoutdeal.GetCalc()}),$("#save").click(function(){_endoutdeal.EndOutDeal()}),$("#update").click(function(){_endoutdeal.UpdateOutDeal()}),$(".close").click(function(a){a.preventDefault(),$(this).closest("div").slideUp()})});