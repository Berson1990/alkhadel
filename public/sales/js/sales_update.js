function up_autocompe(){this.supplier=function(){},this.Customer=function(){},this.Product=function(){$("[name=up_ProductID]").select2({placeholder:"Search for an Customer Name",ajax:{url:"/productautocomplete",headers:{"X-CSRF-Token":$("meta[name=_token]").attr("content")},type:"post",data:function(a){var b={ProductName:a.term};return b},processResults:function(a){return a.status?{results:$.map(a.data,function(a){return{text:a.ProductName,id:a.ProductID,type:a.ProductType,carrying:a.ProductType<1?$("[name=up_ProductID]").data("local"):$("[name=up_ProductID]").data("imported")}})}:{results:$.map(a.data,function(a){return{text:a.message,id:a.id}})}}}})}}var sales_update=function(){var a=new up_autocompe;a.Customer(),a.supplier(),a.Product(),$.fn.modal.Constructor.prototype.enforceFocus=function(){}};sales_update.prototype.GetSalesData=function(a){$.ajax({url:"salesdetails/"+a,headers:{"X-CSRF-Token":$("meta[name=_token]").attr("content")},type:"post",dataType:"json",cache:!0,data:"no data tell now"}).done(function(b){if(b.status){var c=b.data,d=sales_update.prototype.FormatDate(b.data.sales.SalesDate);$("#updatemodal").find("table").find("td").first().next().find("label").text(b.data.sales.SalesID),$("#up_billnumber").text(c.sales.SalesID),$("[name=up_SalesDate]").val(d),$("#up_commision").text(c.salesdetails.Commision),$("#up_discount").text(c.sales.Discount),$("#up_driver").text(c.driver),$("#up_nowlon").text(c.sales.Nowlon),$("#up_custody").text(c.sales.Custody),$("#up_refno").val(c.sales.RefNo),$("[name=up_SupplierID]").append("<option selected='selected' value='"+c.supplier.SupplierID+"'>"+c.supplier.SupplierName+"</option>").trigger("change"),$("[name=up_CustomerID]").append("<option selected='selected' value='"+c.customer.CustomerID+"'>"+c.customer.CustomerName+"</option>").trigger("change"),$("[name=up_ProductID]").append("<option selected='selected' value='"+c.product.ProductID+"'>"+c.product.ProductName+"</option>").find("option:selected").data("data",{id:c.product.ProductID,text:c.product.ProductName,type:c.product.ProductType,carrying:c.product.ProductType<1?$("[name=up_ProductID]").data("local"):$("[name=up_ProductID]").data("imported")}),$("[name=up_ProductID]").trigger("change"),$("[name=up_Carrying]").val(c.salesdetails.Carrying),$("[name=up_Carrying]").attr("placeholder",c.salesdetails.Carrying),$("[name=up_Weight]").val(c.salesdetails.Weight),$("[name=up_Quantity]").val(c.salesdetails.Quantity),$("[name=up_ProductPrice]").val(c.salesdetails.ProductPrice),$("[name=up_Total]").text(c.salesdetails.Total),null!=c.Container?null==c.Container&&void 0==c.Container.ContainerID||($("[name=up_ContainerID]").append('<option value="'+c.Container.ContainerID+'">'+c.Container.ContainerLocalNum+"</option>").trigger("change"),$("[name=up_ContainerID]").val(c.Container.ContainerID).trigger("change")):$("[name=up_ContainerID]").val(0).trigger("change"),$("#UpdateSales").val(a),c.salesdetails.WeightType>0?$("[name=up_Weight]").val(c.salesdetails.Weight).addClass("hidden"):$("[name=up_Weight]").val(c.salesdetails.Weight).removeClass("hidden"),$("[name=up_WeightType][value="+c.salesdetails.WeightType+"]").prop("checked",!0),$("#updatemodal").modal({show:"false"}),$("#updatemodal .modal-header").addClass("btn-primary")}else _sales.ShowNotfication(b.message,!1)}).error(function(a){console.log("error response")})},sales_update.prototype.FormatDate=function(a){var b=new Date(a),c=b.getDate(),d=b.getMonth()+1,e=b.getFullYear(e);return e+"/"+d+"/"+c},sales_update.prototype.GetTotal=function(){var a=$("[name=up_WeightType]:checked").val(),b=$("[name=up_Weight]").val(),c=$("[name=up_ProductPrice]").val(),d=$("[name=up_Quantity]").val(),e=null;e=a>0?d*c:b*d*c,isNaN(e)?$("[name=up_Total]").text("Invalid inputs"):$("[name=up_Total]").text(e)},sales_update.prototype.ShowNotfication=function(a,b){var c=$("#uperror-box");$("#uperror-box").is(":visible")&&c.slideUp(),b?($("#updatemodal .modal-header").addClass("btn-success"),$("#updatemodal .modal-header").removeClass("btn-primary"),$("#updatemodal .modal-header").removeClass("btn-danger"),c.removeClass("alert-danger"),c.addClass("alert-success")):($("#updatemodal .modal-header").addClass("btn-danger"),$("#updatemodal .modal-header").removeClass("btn-primary"),$("#updatemodal .modal-header").removeClass("btn-success"),c.removeClass("alert-success"),c.addClass("alert-danger")),c.find("p").html(a),c.slideDown(),timeOut=window.setTimeout(function(){c.slideUp(),$("#updatemodal .modal-header").addClass("btn-primary"),$("#updatemodal .modal-header").removeClass("btn-success"),$("#updatemodal .modal-header").removeClass("btn-danger")},1e4)},sales_update.prototype.UpdateSales=function(a){$.ajax({url:"sales/update/"+a,type:"post",headers:{"X-CSRF-Token":$("meta[name=_token]").attr("content")},data:$("#frmsales-update").serialize(),dataType:"json"}).done(function(a){if(a.status)_salesupdate.ShowNotfication(a.message,!0),_sales.GetBills();else{var b="";$.each(a.message,function(a,c){b+="* "+c+"</b><br />"}),_salesupdate.ShowNotfication(b,!1)}}).error(function(a){console.log("error")})},sales_update.prototype.DeleteSalesdetails=function(a){$.ajax({url:"sales/salesdetails/"+a,type:"DELETE",headers:{"X-CSRF-Token":$("meta[name=_token]").attr("content")},data:null,dataType:"json"}).done(function(a){if(a.status)_salesupdate.ShowNotfication(a.message,!0),_sales.GetBills();else{var b="";$.each(a.message,function(a,c){b+="* "+c+"</b><br />"}),_salesupdate.ShowNotfication(b,!1)}}).error(function(a){console.log("error")})},sales_update.prototype.ClearUpdateFields=function(){$("#updatemodal").find("input").not("[name=up_WeightType] , #upconfirmBox input").val(""),$("#UpdateSales").val(""),$("#updatemodal").find("select option").empty(),$("#up_billnumber , [name=up_Total]").text("")},sales_update.prototype.IntializeContainerAutocomplete=function(){function a(a){if(a.loading)return"No Result";var b='<div class="clearfix"><div class="col-md-6"><label class="form-control btn-info">LN : '+a.lnum+'</label></div><div class="col-md-6"><label class="form-control btn-primary">IN : '+a.intnum+"</label></div></div>";return b}function b(a){return a.lnum||a.text}$("[name=up_ContainerID]").select2({dropdownCssClass:"widedrop",ajax:{url:"/container/supplier/",headers:{"X-CSRF-Token":$("meta[name=_token]").attr("content")},type:"post",dataType:"json",delay:250,data:function(a){var b={SupplierID:$("[name=up_SupplierID]").val(),LocalNum:a.term};return b},processResults:function(a,b){return $("[name=up_ContainerID] option").not("[value=0]").remove(),$("[name=up_ContainerID]").val(0).trigger("change"),a.status?{results:$.map(a.data,function(a){return{lnum:a.ContainerLocalNum,intnum:a.ContainerIntNum,id:a.ContainerID}})}:{results:{lnum:"No Data",intnum:"No Data",id:"0"}}},cache:!0},escapeMarkup:function(a){return a},templateResult:a,templateSelection:b})},$(document).ready(function(){_salesupdate=new sales_update,_salesupdate.IntializeContainerAutocomplete(),$("body").on("click",".editsales",function(){_salesupdate.ClearUpdateFields(),_salesupdate.GetSalesData($(this).attr("data-val"))}),$("[name=up_ProductID]").change(function(){var a=$("option:selected",$(this)).data("data").carrying;"undefined"==typeof a?$("[name=up_Carrying]").closest("td").prev().find("span").text(""):($("[name=up_Carrying]").closest("td").prev().find("span").text("("+a+")"),$("[name=up_Carrying]").val((a*$("[name=up_Quantity]").val()).toFixed(2)))}),$("[name=up_WeightType]").change(function(){$(this).val()>0?$("[name=up_Weight]").val("1").addClass("hidden"):$("[name=up_Weight]").removeClass("hidden"),_salesupdate.GetTotal()}),$("[name=up_Weight],[name=up_Quantity],[name=up_ProductPrice]").keyup(function(){switch($(this).attr("name")){case"up_Quantity":if($(this).val()>0){var a=$("[name=up_ProductID] option:selected").data("data").carrying;$("[name=up_Carrying]").val((a*$("[name=up_Quantity]").val()).toFixed(2))}}_salesupdate.GetTotal()}),$("#UpdateSales").click(function(){$(this).val()>0?_salesupdate.UpdateSales($(this).val()):_salesupdate.ShowNotfication("Please Select Sales Details To Delete",!1)}),$("#updatemodal").on("hidden.bs.modal",function(){$("#uperror-box").slideUp(),$("#updatemodal .modal-header").addClass("btn-primary"),$("#updatemodal .modal-header").removeClass("btn-success btn-danger")}),$("#delsalesdetails").click(function(){$("#UpdateSales").val()>0?(_sales.GetBills(),$("#upconfirmBox").slideDown()):_salesupdate.ShowNotfication("Please Select Sales Details To Delete",!1)}),$(".closebox").click(function(){"true"==$(this).attr("data-val")&&(_salesupdate.DeleteSalesdetails($("#UpdateSales").val()),$("#upconfirmBox").slideUp())}),$("#updatemodal").on("hide.bs.modal",function(){_salesupdate.ClearUpdateFields()}),$("[name=up_SupplierID]").change(function(){$("[name=up_ContainerID]").val(0).trigger("change")}),$("#editsales").addClass("hide"),$("[name=up_CustomerID]").addClass("hide"),$("[name=up_SupplierID]").addClass("hide")});